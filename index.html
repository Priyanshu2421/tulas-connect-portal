<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TULA'S CONNECT - ERP Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; scroll-behavior: smooth; }
        .nav-link.active { background-color: #15803d; color: #ffffff; font-weight: 600; }
        .nav-link { transition: all 0.2s ease-in-out; }
        .nav-link:hover { background-color: #16a34a; color: white; }
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid #16a34a; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 20px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%;OY overflow: auto; background-color: rgba(0,0,0,0.5); justify-content: center; align-items: center; }
        .modal-content { background-color: #fefefe; margin: auto; padding: 20px; border-radius: 10px; width: 90%; max-width: 600px; max-height: 90vh; display: flex; flex-direction: column; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; padding-bottom: 10px; border-bottom: 1px solid #ddd; }
        .modal-body { overflow-y: auto; padding: 15px 0; flex-grow: 1; }
        .modal-footer { padding-top: 10px; border-top: 1px solid #ddd; text-align: right; }
        .close-btn { color: #aaa; font-size: 28px; font-weight: bold; cursor: pointer; }
        .close-btn:hover { color: black; }
    </style>
</head>

<body class="bg-gray-100 font-sans">

    <!-- TOAST NOTIFICATION -->
    <div id="notification-toast" class="fixed bottom-5 right-5 transform translate-y-full opacity-0 transition-all duration-500 z-50 text-white px-6 py-3 rounded-lg shadow-xl">
        <p id="notification-message"></p>
    </div>

    <!-- CONFIRMATION MODAL -->
    <div id="confirmation-modal" class="modal">
        <div class="modal-content max-w-md">
            <div class="modal-header"><h2 id="modal-title" class="text-xl font-bold">Confirm</h2></div>
            <div class="modal-body"><p id="modal-message" class="text-gray-700">Are you sure?</p></div>
            <div class="modal-footer">
                <button id="modal-cancel-btn" class="bg-gray-300 text-gray-800 px-4 py-2 rounded hover:bg-gray-400 mr-2">Cancel</button>
                <button id="modal-confirm-btn" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">Confirm</button>
            </div>
        </div>
    </div>

    <!-- GENERIC VIEW MODAL -->
    <div id="view-modal" class="modal">
        <div id="view-modal-content" class="modal-content"></div>
    </div>

    <!-- AUTH WRAPPER -->
    <div id="login-signup-wrapper">
        <div class="min-h-screen flex items-center justify-center bg-cover bg-center p-4" style="background-image: url('https://clgtak.com/wp-content/uploads/2023/12/Industry.jpg');">
            <div class="absolute inset-0 bg-black opacity-60"></div>

            <!-- LOGIN CONTAINER -->
            <div id="login-container" class="relative w-full max-w-md p-8 space-y-6 bg-white/95 backdrop-blur-sm rounded-xl shadow-2xl">
                <div class="flex flex-col items-center">
                    <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSv_4ADbeFBqg9mRZQYTRGpzcdXlZN0IFw_0A&s" alt="Logo" class="h-24 w-auto mb-2">
                    <h1 class="text-3xl font-extrabold text-gray-800">TULA'S CONNECT</h1>
                    <p class="text-gray-500 font-medium">ERP Portal</p>
                </div>
                <form id="loginForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Login As</label>
                        <select id="role" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
                            <option value="Student">Student</option>
                            <option value="Faculty">Faculty</option>
                            <option value="Department Login">Department Head (HOD)</option>
                            <option value="Admin">Admin</option>
                        </select>
                    </div>

                    <!-- Department Selection (Hidden by default) -->
                    <div id="department-select-container" class="hidden">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Select Department</label>
                        <select id="department" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                           <option>Department of Computer Applications</option>
                           <option>Department of Engineering</option>
                           <option>Graduate School of Business</option>
                           <option>Department of Agriculture</option>
                           <!-- Add other departments as needed -->
                        </select>
                    </div>
                    <div id="engineering-dept-select-container" class="hidden mt-2">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Engineering Branch</label>
                        <select id="engineering-dept" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                           <option value="">-- Select Branch --</option>
                           <option>Department of Computer Science & Engineering</option>
                           <option>Department of Mechanical Engineering</option>
                           <option>Department of Civil Engineering</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">User ID</label>
                        <input id="userId" type="text" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500" placeholder="e.g., 2023001">
                    </div>
                    <div class="relative">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                        <input id="password" type="password" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢">
                        <button type="button" id="toggle-password" class="absolute top-8 right-3 text-gray-400 hover:text-gray-600">
                            <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" /></svg>
                        </button>
                    </div>
                    <div id="error-message" class="text-red-600 text-sm text-center font-medium min-h-[1.5rem]"></div>
                    <button type="submit" class="w-full py-3 bg-green-600 hover:bg-green-700 text-white font-bold rounded-lg transition duration-200">Secure Login</button>
                </form>
                <div class="text-center text-sm text-gray-600 space-y-2">
                    <p><a href="#" id="show-signup-link" class="text-green-700 hover:underline font-semibold">New User? Register Here</a></p>
                </div>
            </div>

            <!-- SIGNUP CONTAINER (Simplified for brevity) -->
            <div id="signup-container" class="hidden relative w-full max-w-md p-8 bg-white/95 backdrop-blur-sm rounded-xl shadow-2xl">
                <h2 class="text-2xl font-bold text-center text-gray-800 mb-6">Create Account</h2>
                <form id="signupForm" class="space-y-4">
                    <input type="text" name="name" placeholder="Full Name" required class="w-full px-4 py-2 border rounded-lg">
                    <input type="text" name="userId" placeholder="User ID / Roll No." required class="w-full px-4 py-2 border rounded-lg">
                    <input type="email" name="email" placeholder="Email Address" required class="w-full px-4 py-2 border rounded-lg">
                    <input type="password" name="pass" placeholder="Create Password" required class="w-full px-4 py-2 border rounded-lg">
                    <select name="role" id="signup-role" required class="w-full px-4 py-2 border rounded-lg">
                        <option value="">Select Role</option>
                        <option value="Student">Student</option>
                        <option value="Faculty">Faculty</option>
                    </select>
                    <!-- Dynamic Dept/Course dropdowns would go here similar to Login -->
                    <button type="submit" class="w-full py-3 bg-green-600 text-white font-bold rounded-lg">Register</button>
                </form>
                <p class="text-center mt-4"><a href="#" id="show-login-link" class="text-green-700 font-semibold">Back to Login</a></p>
            </div>
        </div>
    </div>

    <!-- MAIN DASHBOARD -->
    <div id="dashboard-container" class="hidden min-h-screen bg-gray-50">
        <!-- HEADER -->
        <header class="bg-white shadow-md fixed top-0 w-full z-40 h-16">
            <div class="max-w-7xl mx-auto px-4 h-full flex items-center justify-between">
                <div class="flex items-center">
                    <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSv_4ADbeFBqg9mRZQYTRGpzcdXlZN0IFw_0A&s" alt="Logo" class="h-10 w-auto mr-3">
                    <div>
                        <h1 id="welcome-message" class="font-bold text-gray-800 leading-tight">Welcome</h1>
                        <p id="user-role" class="text-xs text-gray-500 leading-tight">Role</p>
                    </div>
                </div>
                <div class="flex items-center">
                    <img id="header-profile-pic" src="" class="h-10 w-10 rounded-full border-2 border-green-500 object-cover mr-3" onerror="this.src='https://placehold.co/40?text=U'">
                    <button id="logout-button" class="bg-red-100 text-red-700 px-3 py-1 rounded-md text-sm font-medium hover:bg-red-200 transition">Logout</button>
                    <!-- Mobile menu button -->
                    <button id="mobile-menu-btn" class="ml-3 md:hidden p-2 text-gray-600">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
                    </button>
                </div>
            </div>
        </header>

        <!-- SIDEBAR NAV (Desktop) -->
        <aside id="sidebar" class="fixed left-0 top-16 bottom-0 w-64 bg-green-900 text-white transition-transform transform -translate-x-full md:translate-x-0 z-30 overflow-y-auto">
            <nav id="desktop-nav-links" class="p-4 space-y-2"></nav>
        </aside>

        <!-- MAIN CONTENT AREA -->
        <main class="md:ml-64 pt-20 pb-24 md:pb-8 p-4 md:p-6 transition-all">
            <div id="main-content" class="max-w-5xl mx-auto">
                <!-- Dynamic Content Loads Here -->
            </div>
        </main>

        <!-- MOBILE BOTTOM NAV -->
        <div id="mobile-nav" class="md:hidden fixed bottom-0 w-full bg-white border-t border-gray-200 z-40">
            <nav id="mobile-nav-links" class="flex overflow-x-auto py-2 px-4 space-x-4"></nav>
        </div>
    </div>

<script>
// --- CONFIGURATION ---
const API_BASE_URL = ''; // Empty for same-domain (Render)

// --- UTILITIES ---
const showToast = (msg, isError = false) => {
    const toast = document.getElementById('notification-toast');
    document.getElementById('notification-message').textContent = msg;
    toast.className = `fixed bottom-5 right-5 transform translate-y-0 opacity-100 transition-all duration-300 z-50 text-white px-6 py-3 rounded-lg shadow-xl ${isError ? 'bg-red-600' : 'bg-green-600'}`;
    setTimeout(() => toast.classList.replace('translate-y-0', 'translate-y-full'), 3000);
    setTimeout(() => toast.classList.replace('opacity-100', 'opacity-0'), 3000);
};

const renderLoader = (el) => el.innerHTML = '<div class="loader"></div>';

// --- GLOBAL STATE ---
let currentUser = JSON.parse(sessionStorage.getItem('loggedInUser')) || null;

// --- INITIALIZATION ---
document.addEventListener('DOMContentLoaded', () => {
    checkAuthState();
    initEventListeners();
});

function checkAuthState() {
    if (currentUser) {
        showDashboard(currentUser);
    } else {
        document.getElementById('login-signup-wrapper').classList.remove('hidden');
        document.getElementById('dashboard-container').classList.add('hidden');
    }
}

function initEventListeners() {
    // Login Role Toggle
    const roleSelect = document.getElementById('role');
    const deptContainer = document.getElementById('department-select-container');
    const engContainer = document.getElementById('engineering-dept-select-container');
    const deptSelect = document.getElementById('department');

    // CRITICAL FIX: Ensure department shows up instantly on selection
    function updateLoginUI() {
        const isHOD = roleSelect.value === 'Department Login';
        deptContainer.classList.toggle('hidden', !isHOD);
        
        // Only show engineering sub-select if HOD AND Dept is Engineering
        const isEng = isHOD && deptSelect.value === 'Department of Engineering';
        engContainer.classList.toggle('hidden', !isEng);
    }
    roleSelect.addEventListener('change', updateLoginUI);
    deptSelect.addEventListener('change', updateLoginUI);
    // Run once on load in case browser cached values
    updateLoginUI();

    // Login Submit
    document.getElementById('loginForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const errorEl = document.getElementById('error-message');
        errorEl.textContent = '';
        
        const role = roleSelect.value;
        let finalRole = role === 'Department Login' ? 'HOD' : role;
        let dept = null;

        if (role === 'Department Login') {
            dept = deptSelect.value;
            if (dept === 'Department of Engineering') {
                dept = document.getElementById('engineering-dept').value;
                if (!dept) return errorEl.textContent = 'Please select Engineering Branch';
            }
        }

        const payload = {
            userId: document.getElementById('userId').value.trim(),
            password: document.getElementById('password').value,
            role: finalRole,
            department: dept
        };

        try {
            const btn = e.target.querySelector('button[type="submit"]');
            btn.textContent = 'Logging in...'; btn.disabled = true;
            
            const res = await fetch(`${API_BASE_URL}/login`, {
                method: 'POST', headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            const data = await res.json();

            if (data.success) {
                sessionStorage.setItem('loggedInUser', JSON.stringify(data.user));
                currentUser = data.user;
                showDashboard(data.user);
            } else {
                errorEl.textContent = data.message || 'Login failed';
            }
        } catch (err) {
            errorEl.textContent = 'Server connection failed. Try again.';
        } finally {
            e.target.querySelector('button[type="submit"]').textContent = 'Secure Login';
            e.target.querySelector('button[type="submit"]').disabled = false;
        }
    });

    // Auth Switchers
    document.getElementById('show-signup-link').onclick = (e) => { e.preventDefault(); toggleAuth('signup'); };
    document.getElementById('show-login-link').onclick = (e) => { e.preventDefault(); toggleAuth('login'); };
    
    // Logout
    document.getElementById('logout-button').onclick = () => {
        sessionStorage.clear();
        window.location.reload();
    };

    // Mobile Menu Toggle
    document.getElementById('mobile-menu-btn').onclick = () => {
        document.getElementById('sidebar').classList.toggle('-translate-x-full');
    };
}

function toggleAuth(view) {
    document.getElementById('login-container').classList.toggle('hidden', view !== 'login');
    document.getElementById('signup-container').classList.toggle('hidden', view !== 'signup');
}

// --- DASHBOARD LOGIC ---
function showDashboard(user) {
    document.getElementById('login-signup-wrapper').classList.add('hidden');
    document.getElementById('dashboard-container').classList.remove('hidden');
    
    document.getElementById('welcome-message').textContent = `Welcome, ${user.name.split(' ')[0]}`;
    document.getElementById('user-role').textContent = user.role + (user.department ? ` (${user.department})` : '');
    document.getElementById('header-profile-pic').src = user.photoUrl ? `${API_BASE_URL}${user.photoUrl}` : 'https://placehold.co/100?text=User';

    generateNavLinks(user.role);
}

function generateNavLinks(role) {
    const desktopNav = document.getElementById('desktop-nav-links');
    const mobileNav = document.getElementById('mobile-nav-links');
    desktopNav.innerHTML = ''; mobileNav.innerHTML = '';

    // Define menus based on role
    const menus = {
        'Student': [
            { name: 'Profile', id: 'profile', icon: 'ðŸ‘¤' },
            { name: 'Placements', id: 'placements', icon: 'ðŸ’¼' },
            { name: 'Timetable', id: 'timetable', icon: 'ðŸ“…' },
            // Add more student links here
        ],
        'Faculty': [
             { name: 'Profile', id: 'profile', icon: 'ðŸ‘¤' },
             { name: 'Placements', id: 'faculty-placements', icon: 'hj' },
             // Add Faculty links
        ],
        'HOD': [
             { name: 'Dashboard', id: 'hod-dash', icon: 'ðŸ“Š' },
             { name: 'Placements', id: 'faculty-placements', icon: 'ðŸ’¼' },
             { name: 'Profile', id: 'profile', icon: 'ðŸ‘¤' },
        ],
        'Admin': [
            { name: 'Manage Users', id: 'admin-users', icon: 'ðŸ‘¥' },
            { name: 'Placements', id: 'admin-placements', icon: 'ðŸ’¼' },
        ]
    };

    const links = menus[role] || menus['Student']; // Default fallback

    links.forEach(link => {
        // Desktop Link
        const dLink = document.createElement('button');
        dLink.className = 'nav-link w-full flex items-center space-x-3 px-4 py-3 rounded-lg text-left';
        dLink.innerHTML = `<span class="text-xl">${link.icon}</span><span class="font-medium">${link.name}</span>`;
        dLink.onclick = () => loadPage(link.id, dLink);
        desktopNav.appendChild(dLink);

        // Mobile Link
        const mLink = document.createElement('button');
        mLink.className = 'flex flex-col items-center min-w-[4rem] py-1 px-2 rounded-lg text-gray-600';
        mLink.innerHTML = `<span class="text-2xl">${link.icon}</span><span class="text-xs">${link.name}</span>`;
        mLink.onclick = () => loadPage(link.id, null, mLink);
        mobileNav.appendChild(mLink);
    });

    // Load first page automatically
    if (desktopNav.firstChild) desktopNav.firstChild.click();
}

function loadPage(pageId, activeDLink, activeMLink) {
    // Update Active States
    document.querySelectorAll('#desktop-nav-links .nav-link').forEach(el => el.classList.remove('active', 'bg-green-800'));
    if(activeDLink) activeDLink.classList.add('active', 'bg-green-800');
    
    document.querySelectorAll('#mobile-nav-links button').forEach(el => el.classList.remove('text-green-700', 'font-bold'));
    if(activeMLink) activeMLink.classList.add('text-green-700', 'font-bold');

    // Close mobile sidebar if open
    document.getElementById('sidebar').classList.add('-translate-x-full');

    const contentEl = document.getElementById('main-content');
    renderLoader(contentEl);

    // --- PAGE ROUTER ---
    switch(pageId) {
        case 'profile': loadProfile(contentEl); break;
        case 'admin-placements': loadAdminPlacements(contentEl); break;
        case 'placements': loadStudentPlacements(contentEl); break;
        case 'faculty-placements': loadFacultyPlacements(contentEl); break;
        default: contentEl.innerHTML = `<div class="bg-white p-8 rounded-xl shadow-sm text-center"><h2 class="text-2xl font-bold text-gray-400">${pageId.replace('-', ' ').toUpperCase()}</h2><p class="text-gray-500 mt-2">Under Construction</p></div>`;
    }
}

// --- PAGE FUNCTIONS (Simplified Examples) ---
async function loadProfile(container) {
    try {
        const res = await fetch(`${API_BASE_URL}/profile/${currentUser.id}`);
        const data = await res.json();
        if (!data.success) throw new Error(data.message);
        const p = data.profile;
        container.innerHTML = `
            <div class="bg-white rounded-2xl shadow-sm overflow-hidden">
                <div class="bg-green-600 h-32"></div>
                <div class="px-6 md:px-8 pb-8 relative">
                    <img src="${p.photoUrl ? API_BASE_URL+p.photoUrl : 'https://placehold.co/150?text=User'}" class="w-32 h-32 rounded-full border-4 border-white absolute -top-16 shadow-md object-cover">
                    <div class="mt-20 md:flex justify-between items-start">
                        <div>
                            <h1 class="text-3xl font-bold text-gray-900">${p.name}</h1>
                            <p class="text-green-700 font-medium">${p.role} ${p.id}</p>
                            <p class="text-gray-500">${p.department || ''}</p>
                        </div>
                        <button class="mt-4 md:mt-0 px-6 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg font-medium transition">Edit Profile</button>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-8">
                         <div class="p-4 bg-gray-50 rounded-xl"><p class="text-xs text-gray-500 uppercase font-semibold">Email</p><p class="text-lg">${p.email}</p></div>
                         <div class="p-4 bg-gray-50 rounded-xl"><p class="text-xs text-gray-500 uppercase font-semibold">Phone</p><p class="text-lg">${p.phone}</p></div>
                         <!-- Add other fields -->
                    </div>
                </div>
            </div>
        `;
    } catch (e) {
        container.innerHTML = `<div class="text-red-500 bg-white p-6 rounded-xl">Failed to load profile: ${e.message}</div>`;
    }
}

// --- PLACEMENT PAGES (Admin/Student/Faculty) ---
async function loadAdminPlacements(container) {
    // Simplified Admin Placement View
    container.innerHTML = `
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-bold text-gray-800">Placement Drives</h2>
            <button onclick="openPostPlacementModal()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">+ Post New Drive</button>
        </div>
        <div id="admin-placement-list" class="grid gap-4">Loading...</div>
    `;
    loadPlacementsList('admin-placement-list', true);
}

async function loadStudentPlacements(container) {
    container.innerHTML = `
        <h2 class="text-2xl font-bold text-gray-800 mb-6">Available Opportunities</h2>
        <div id="student-placement-list" class="grid gap-4">Loading...</div>
    `;
    loadPlacementsList('student-placement-list', false, true);
}

async function loadFacultyPlacements(container) {
     container.innerHTML = `
        <h2 class="text-2xl font-bold text-gray-800 mb-6">Department Placements</h2>
        <div id="faculty-placement-list" class="grid gap-4">Loading...</div>
    `;
    // Load placements filtered by faculty's department
    loadPlacementsList('faculty-placement-list', true, false, currentUser.department);
}

async function loadPlacementsList(elementId, isAdmin, isStudent = false, deptFilter = null) {
    try {
        let url = `${API_BASE_URL}/placements`;
        if (isStudent) url += `?department=${encodeURIComponent(currentUser.department)}&course=${encodeURIComponent(currentUser.course || '')}`;
        if (deptFilter) url += `?department=${encodeURIComponent(deptFilter)}`;

        const res = await fetch(url);
        const data = await res.json();
        const listEl = document.getElementById(elementId);
        
        if (!data.placements || data.placements.length === 0) {
            listEl.innerHTML = `<div class="p-8 bg-white rounded-xl text-center text-gray-500">No placement drives found.</div>`;
            return;
        }

        listEl.innerHTML = data.placements.map(p => `
            <div class="bg-white p-6 rounded-xl shadow-sm border-l-4 border-green-500 flex flex-col md:flex-row justify-between">
                <div>
                    <h3 class="text-xl font-bold text-gray-900">${p.jobTitle}</h3>
                    <p class="text-green-700 font-medium">${p.companyName}</p>
                    <p class="text-sm text-gray-500 mt-2">${p.department} | ${p.course}</p>
                    <p class="text-xs text-gray-400 mt-1">Posted: ${new Date(p.postedOn).toLocaleDateString()}</p>
                </div>
                <div class="mt-4 md:mt-0 flex items-center">
                    ${isAdmin ? `<button class="px-4 py-2 bg-blue-50 text-blue-600 rounded-lg font-medium">View Applicants (${p.applications.length})</button>` : ''}
                    ${isStudent ? (p.applications.some(a => a.studentId === currentUser.id) ? 
                        `<span class="px-4 py-2 bg-green-100 text-green-700 rounded-lg font-medium">Applied âœ…</span>` : 
                        `<button onclick="applyForPlacement(${p.id})" class="px-6 py-2 bg-green-600 text-white rounded-lg font-medium hover:bg-green-700">Apply Now</button>`
                    ) : ''}
                </div>
            </div>
        `).join('');
    } catch (e) {
        document.getElementById(elementId).innerHTML = `<div class="text-red-500">Error loading data.</div>`;
    }
}

// Global function for applying (simplified)
window.applyForPlacement = async (id) => {
    if (!confirm('Apply for this position? (Ensure you have a resume uploaded in profile)')) return;
    // Actual implementation needs file upload modal
    showToast('Application feature requires Resume upload implementation.', true);
};

// Admin Modal (Stub)
window.openPostPlacementModal = () => {
    alert("Post placement modal would open here.");
};

</script>
</body>
</html>